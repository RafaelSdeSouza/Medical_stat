warmup=750)
Y_mean <- extract(fit, "mu_pred")
Y_mean_cred <- apply(Y_mean$mu_pred, 2, quantile, c(0.05, 0.95))
Y_mean_mean <- apply(Y_mean$mu_pred, 2, mean)
fitdat <- data.frame(x = XX, y = Y_mean_mean, lwr1 = Y_mean_cred[1,],upr1 = Y_mean_cred[2,])
ggplot(data=gdat,aes(x=x,y=y)) +
geom_point() +
geom_line(data=fitdat,aes(x=x,y=y)) +
geom_ribbon(data=fitdat,aes(x=x,ymin=lwr1, ymax=upr1,y=NULL),fill=c("gray50"),alpha=0.5) +
theme_bw()
fitdat <- data.frame(x = X, y = Y_mean_mean, lwr1 = Y_mean_cred[1,],upr1 = Y_mean_cred[2,])
ggplot(data=gdat,aes(x=x,y=y)) +
geom_point() +
geom_line(data=fitdat,aes(x=x,y=y)) +
geom_ribbon(data=fitdat,aes(x=x,ymin=lwr1, ymax=upr1,y=NULL),fill=c("gray50"),alpha=0.5) +
theme_bw()
setwd("~/Documents/bebe_stat")
preg <- read.cs("BTA-Pregnancies-anonymized.csv")
preg <- read.csv("BTA-Pregnancies-anonymized.csv")
preg
dim(pref)
dim(preg)
head(preg)
colnames(preg)
require(dplyr)
require(magrittr)
head(preg)
preg <- read.csv("BTA-Pregnancies-anonymized.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX"))
fit <- gam(BECOME_PREGNANT~s(AGE|LIGATION_GROUP))
require(mgcv)
fit <- gam(BECOME_PREGNANT~s(AGE|LIGATION_GROUP))
fit <- gam(BECOME_PREGNANT~s(AGE|LIGATION_GROUP),data=preg)
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15) + LIGATION_GROUP,data=preg)
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit,"AGE","LIGATION_GROUP",scale="response",
ylab = "UV upturn fraction", xlab="Redshift",xlim=range(x1))
require(visreg)
visreg(fit,"AGE","LIGATION_GROUP",scale="response",
ylab = "UV upturn fraction", xlab="Redshift",xlim=range(x1))
visreg(fit,"AGE","LIGATION_GROUP",scale="response",
ylab = "BECOME_PREGNANT", xlab="AGE")
visreg(fit,"AGE","LIGATION_GROUP",
ylab = "BECOME_PREGNANT", xlab="AGE")
preg$AGE
range(preg$AGE)
hist(preg$AGE)
preg <- read.csv("BTA-Pregnancies-anonymized.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX")) %>%
filter(AGE > 0)
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit,"AGE","LIGATION_GROUP",
ylab = "BECOME_PREGNANT", xlab="AGE")
preg$BECOME_PREGNANT
preg <- read.csv("BTA-Pregnancies-anonymized.csv")
head(preg)
preg <- read.csv("BTA-Pregnancies-anonymized.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX")) %>%
filter(AGE > 0)
preg$PREGNANT_NUMERIC
table(preg$PREGNANT_NUMERIC)
preg <- read.csv("BTA-Pregnancies-anonymized.csv")
head(preg)
preg$OUTCOMEGROUP1
table(preg$OUTCOMEGROUP1)
table(preg$BECOME_PREGNANT)
head(pref)
head(preg)
colnames(preg)
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX")) %>%
filter(AGE > 0)
preg$AGE
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX")) %>%
filter(AGE != "Yes")
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit,"AGE","LIGATION_GROUP",
ylab = "BECOME_PREGNANT", xlab="AGE")
preg
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
preg$AGE
as.numeric(preg$AGE)
range(as.numeric(preg$AGE))
range(preg$AGE)
preg$AGE
as.numeric(as.character(preg$AGE))
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10)
preg
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit,"AGE","LIGATION_GROUP",
ylab = "BECOME_PREGNANT", xlab="AGE")
visreg(fit,"AGE","LIGATION_GROUP",
ylab = "BECOME_PREGNANT", xlab="AGE",scale="response")
visreg(fit,"AGE","LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
visreg(fit,"AGE","LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",verlay=TRUE)
visreg(fit,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",verlay=TRUE)
visreg(fit,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",overlay=TRUE)
visreg(fit,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
preg <- read.csv("BTA-Patients-MAW.csv")
head(preg)
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10)
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(AV_TUBELENGTH_GP,bs="cr",k=15) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg2d(fit,"AGE","AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",plot.type = "persp")
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10)
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(AV_TUBELENGTH_GP,bs="cr",k=15) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg2d(fit,"AGE","AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",plot.type = "persp")
fit
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(AV_TUBELENGTH_GP,bs="cr",k=15) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(AV_TUBELENGTH_GP,bs="cr",k=5) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg2d(fit,"AGE","AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",plot.type = "persp")
preg$AV_TUBELENGTH_GP
range(preg$AV_TUBELENGTH_GP)
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10) %>% filter(AV_TUBELENGTH_GP !=NA)
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10) %>%
na.omit()
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(AV_TUBELENGTH_GP,bs="cr",k=5) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg2d(fit,"AGE","AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",plot.type = "persp")
preg$AV_TUBELENGTH_GP
range(preg$AV_TUBELENGTH_GP)
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(AV_TUBELENGTH_GP,bs="cr",2) + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg2d(fit,"AGE","AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",plot.type = "persp")
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + AV_TUBELENGTH_GP  + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg2d(fit,"AGE","AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",plot.type = "persp")
fit
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + AV_TUBELENGTH_GP  + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
fit
visreg(fit,"AGE","AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",plot.type = "persp")
visreg(fit,"AGE","AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + AV_TUBELENGTH_GP  + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
visreg(fit,"AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
visreg(fit,"AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
visreg(fit,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
visreg(fit,"AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
plot(preg$LEFT_TUBE_LENGTH,preg$RIGHT_TUBE_LENGTH)
preg$RIGHT_TUBE_LENGTH
preg$LEFT_TUBE_LENGTH
plot(as.numeric(as.character(preg$LEFT_TUBE_LENGTH)),preg$RIGHT_TUBE_LENGTH)
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10) %>%
na.omit() %>% mutate(AGE = as.numeric(as.character(LEFT_TUBE_LENGTH)) )
plot(preg$LEFT_TUBE_LENGTH,preg$RIGHT_TUBE_LENGTH)
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10) %>%
na.omit() %>% mutate(LEFT_TUBE_LENGTH = as.numeric(as.character(LEFT_TUBE_LENGTH)) )
plot(preg$LEFT_TUBE_LENGTH,preg$RIGHT_TUBE_LENGTH)
princomp(preg$LEFT_TUBE_LENGTH,preg$RIGHT_TUBE_LENGTH)
pca_dat <- data.frame(preg$LEFT_TUBE_LENGTH,preg$RIGHT_TUBE_LENGTH)
res.pca <- prcomp(pca_dat, scale = TRUE)
plot(res.pca )
eig <- (res.pca$sdev)^2
# Variances in percentage
variance <- eig*100/sum(eig)
# Cumulative variances
cumvar <- cumsum(variance)
eig
eig.tube <- data.frame(eig = eig, variance = variance,
cumvariance = cumvar)
head(eig.tube)
eig
library("FactoMineR")
install.packages("FactoMineR")
library(FactoMineR)
res.pca <- PCA(pca_dat, scale.unit = TRUE, ncp = 2, graph = TRUE)
# Eigenvalues
res.pca
get_eigenvalue(res.pca)
library("factoextra")
install.packages("factoextra")
library("factoextra")
get_eigenvalue(res.pca)
viz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
fill.ind = iris$Species,
col.ind = "black",
repel = TRUE        # Avoid label overplotting
)
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
fill.ind = iris$Species,
col.ind = "black",
repel = TRUE        # Avoid label overplotting
)
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
fill.ind = iris$Species,
col.ind = "black",
repel = TRUE        # Avoid label overplotting
)
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
col.ind = "black",
repel = TRUE        # Avoid label overplotting
)
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
fill.ind = "orange",
col.ind = "black",
repel = TRUE        # Avoid label overplotting
)
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
fill.ind = preg$LIGATION_GROUP,
col.ind = "black",
repel = TRUE        # Avoid label overplotting
)
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
fill.ind = preg$LIGATION_GROUP,
col.ind = "black",
repel = TRUE        # Avoid label overplotting
) +
ggpubr::fill_palette("jco")+      # Indiviual fill color
ggpubr::color_palette("npg")      # Variable colors
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
fill.ind = preg$LIGATION_GROUP,
col.ind = "black",
repel = TRUE,        # Avoid label overplotting
legend.title = list(fill = "Ligation Group")
) +
ggpubr::fill_palette("jco")+      # Indiviual fill color
ggpubr::color_palette("npg")      # Variable colors
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = preg$LIGATION_GROUP,
pointsize = 2.5,
fill.ind = preg$LIGATION_GROUP,
col.ind = "black",
repel = TRUE,        # Avoid label overplotting
legend.title = list(fill = "Ligation Group")
) +
ggpubr::fill_palette("jco")+      # Indiviual fill color
ggpubr::color_palette("npg")      # Variable colors
preg$LIGATION_GROUP
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = as.numeric(preg$LIGATION_GROUP),
pointsize = 2.5,
fill.ind = preg$LIGATION_GROUP,
col.ind = "black",
repel = TRUE,        # Avoid label overplotting
legend.title = list(fill = "Ligation Group")
) +
ggpubr::fill_palette("jco")+      # Indiviual fill color
ggpubr::color_palette("npg")      # Variable colors
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = as.factor(preg$LIGATION_GROUP),
pointsize = 2.5,
fill.ind = preg$LIGATION_GROUP,
col.ind = "black",
repel = TRUE,        # Avoid label overplotting
legend.title = list(fill = "Ligation Group")
) +
ggpubr::fill_palette("jco")+      # Indiviual fill color
ggpubr::color_palette("npg")      # Variable colors
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
fill.ind = preg$LIGATION_GROUP,
col.ind = "black",
repel = TRUE,        # Avoid label overplotting
legend.title = list(fill = "Ligation Group")
) +
ggpubr::fill_palette("jco")+      # Indiviual fill color
ggpubr::color_palette("npg")      # Variable colors
res.pca$eig
res.pca$var
print(res.pca)
res.pca$var
pr <- prcomp(pca_dat, scale=T)
pr$rotation
pca_dat
data.frame(pr$x[,1:2])
comp <- data.frame(pr$x[,1:2])
plot(comp)
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10) %>%
na.omit() %>% mutate(LEFT_TUBE_LENGTH = as.numeric(as.character(LEFT_TUBE_LENGTH)) ) %>%
mutate(PCA_TUBE_LENGTH = prcomp(c(LEFT_TUBE_LENGTH,RIGHT_TUBE_LENGTH), scale=T)$x[,1])
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10) %>%
na.omit() %>% mutate(LEFT_TUBE_LENGTH = as.numeric(as.character(LEFT_TUBE_LENGTH)) ) %>%
mutate(PCA_TUBE_LENGTH = prcomp(data.frame(LEFT_TUBE_LENGTH,RIGHT_TUBE_LENGTH), scale=T)$x[,1])
preg$PCA_TUBE_LENGTH
preg$PCA_TUBE_LENGTH-comp[,1]
fit2 <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + PCA_TUBE_LENGTH  + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit2,"PCA_TUBE_LENGTH ",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
visreg(fit2,"PCA_TUBE_LENGTH",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
fit2 <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(PCA_TUBE_LENGTH,bs="cr",k=15)  + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit2,"PCA_TUBE_LENGTH",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10) %>%
na.omit() %>% mutate(LEFT_TUBE_LENGTH = as.numeric(as.character(LEFT_TUBE_LENGTH)) ) %>%
mutate(PCA_TUBE_LENGTH = prcomp(data.frame(LEFT_TUBE_LENGTH,RIGHT_TUBE_LENGTH))$x[,1])
fit2 <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(PCA_TUBE_LENGTH,bs="cr",k=15)  + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
visreg(fit,"AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
visreg(fit2,"PCA_TUBE_LENGTH",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
visreg(fit2,"PCA_TUBE_LENGTH",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="PC1",scale="response")
visreg(fit2,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
visreg(fit2,"PCA_TUBE_LENGTH",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="PC1",scale="response")
plot(comp[,1],pca_dat[,1])
plot(comp[,1],pca_dat[,2])
preg$LEFT_TUBE_LENGTH
range(preg$LEFT_TUBE_LENGTH)
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10) %>%
na.omit() %>% mutate(LEFT_TUBE_LENGTH = as.numeric(as.character(LEFT_TUBE_LENGTH)) ) %>%
mutate(PCA_TUBE_LENGTH = prcomp(data.frame(RIGHT_TUBE_LENGTH,LEFT_TUBE_LENGTH))$x[,1])
pca_dat <- data.frame(preg$LEFT_TUBE_LENGTH,preg$RIGHT_TUBE_LENGTH)
res.pca <- PCA(pca_dat, scale.unit = TRUE, ncp = 2, graph = TRUE)
fviz_pca_biplot(res.pca,
# Fill individuals by groups
geom.ind = "point",
pointshape = 21,
pointsize = 2.5,
fill.ind = preg$LIGATION_GROUP,
col.ind = "black",
repel = TRUE,        # Avoid label overplotting
legend.title = list(fill = "Ligation Group")
) +
ggpubr::fill_palette("jco")+      # Indiviual fill color
ggpubr::color_palette("npg")      # Variable colors
fit <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + AV_TUBELENGTH_GP  + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
fit2 <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(PCA_TUBE_LENGTH,bs="cr",k=15)  + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit,"AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
visreg(fit2,"PCA_TUBE_LENGTH",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="PC1",scale="response")
visreg(fit2,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
visreg(fit2,"PCA_TUBE_LENGTH",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="PC1",scale="response")
visreg(fit,"AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
visreg2d(fit2,"AGE","PC1",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",type="persp")
visreg2d(fit2,"AGE","PC1",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",plot.type = "persp")
visreg2d(fit2,"AGE","PCA_TUBE_LENGTH",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response",plot.type = "persp")
visreg2d(fit2,"AGE","PCA_TUBE_LENGTH",
ylab = "PCA_TUBE_LENGTH", xlab="AGE",scale="response",plot.type = "persp")
visreg2d(fit2,"AGE","PCA_TUBE_LENGTH",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp")
visreg2d(fit2,"AGE","PCA_TUBE_LENGTH",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35)
visreg2d(fit2,"AGE","PCA_TUBE_LENGTH",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35,theta=60)
visreg2d(fit2,"AGE","PCA_TUBE_LENGTH",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35,theta=50)
visreg2d(fit2,"AGE","PCA_TUBE_LENGTH",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35,theta=45)
visreg2d(fit2,"AGE","PCA_TUBE_LENGTH",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35,theta=47.5)
visreg2d(fit1,"AGE","AV_TUBELENGTH_GP",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35,theta=47.5)
visreg2d(fit,"AGE","AV_TUBELENGTH_GP",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35,theta=47.5)
preg <- read.csv("BTA-Patients-MAW.csv") %>% select(c("BECOME_PREGNANT","TUBELENGTH_R_DISTAL","PREGNANT_NUMERIC",
"TUBELENGTH_L_DISTAL","LIGATION_GROUP",
"AGE","RIGHT_TUBE_LENGTH","LEFT_TUBE_LENGTH",
"TUBELENGTH_R_PROX","TUBELENGTH_L_PROX","AV_TUBELENGTH_GP")) %>%
filter(AGE != "Yes") %>%  mutate(AGE = as.numeric(as.character(AGE)) )  %>%
filter(AGE > 10) %>%
na.omit() %>% mutate(LEFT_TUBE_LENGTH = as.numeric(as.character(LEFT_TUBE_LENGTH)) ) %>%
mutate(PCA_TUBE_LENGTH = -prcomp(data.frame(RIGHT_TUBE_LENGTH,LEFT_TUBE_LENGTH))$x[,1])
fit2 <- gam(BECOME_PREGNANT~s(AGE,bs="cr",k=15)  + s(PCA_TUBE_LENGTH,bs="cr",k=15)  + LIGATION_GROUP,data=preg,family= binomial(link="logit"),method="REML")
visreg(fit,"AV_TUBELENGTH_GP",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AV_TUBELENGTH_GP",scale="response")
visreg(fit2,"PCA_TUBE_LENGTH",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="PC1",scale="response")
visreg(fit2,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
visreg2d(fit,"AGE","AV_TUBELENGTH_GP",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35,theta=47.5)
visreg2d(fit,"AGE","AV_TUBELENGTH_GP",
ylab = "Average Tube length", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35,theta=47.5)
visreg2d(fit2,"AGE","PCA_TUBE_LENGTH",
ylab = "PC1", xlab="AGE",zlab="Probability Pregnancy",scale="response",plot.type = "persp",
phi=35,theta=47.5)
visreg(fit2,"PCA_TUBE_LENGTH",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="PC1",scale="response")
visreg(fit2,"AGE",by="LIGATION_GROUP",
ylab = "BECOME PREGNANT", xlab="AGE",scale="response")
