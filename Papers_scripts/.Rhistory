my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
coord_cartesian(xlim=c(20,48)) +
xlab("Age (yr)")
direct.label(g,"angled.endpoints")
g <- ggplot(ale_gam_all_age,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.3) +
#+ geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
coord_cartesian(xlim=c(20,48),ylim=c(0,0.6)) +
xlab("Age (yr)")
direct.label(g,"angled.endpoints")
g <- ggplot(ale_gam_all_age,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.3) +
#+ geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
coord_cartesian(xlim=c(20,48),ylim=c(0.1,0.7)) +
xlab("Age (yr)")
direct.label(g,"angled.endpoints")
pdf("ale_age_outcome.pdf",height = 5.5,width = 6.5)
g <- ggplot(ale_gam_all_age,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.3) +
#+ geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
coord_cartesian(xlim=c(20,48),ylim=c(0.1,0.7)) +
xlab("Age (yr)")
direct.label(g,"angled.endpoints")
dev.off()
pdf("ale_TL_outcome.pdf",height = 5.5,width = 6.5)
g2 <- ggplot(ale_gam_all_Length,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.275) +
# geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
ylab("Outcome likelihood") + xlab("Length (cm)") +
coord_cartesian(xlim=c(0,10),ylim=c(0.1,0.7)) + facet_wrap(.~var)
direct.label(g2,"lasso.labels")
dev.off()
pdf("ale_TL_outcome.pdf",height = 5.5,width = 6.5)
g2 <- ggplot(ale_gam_all_Length,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.275) +
# geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
ylab("Outcome likelihood") + xlab("Length (cm)") +
coord_cartesian(xlim=c(0,10)) + facet_wrap(.~var)
direct.label(g2,"lasso.labels")
dev.off()
pdf("ale_TL_outcome.pdf",height = 5.5,width = 6.5)
g2 <- ggplot(ale_gam_all_Length,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.275) +
# geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
ylab("Outcome likelihood") + xlab("Length (cm)") +
coord_cartesian(xlim=c(0.1,10)) + facet_wrap(.~var)
direct.label(g2,"lasso.labels")
dev.off()
pdf("ale_TL_outcome.pdf",height = 5.5,width = 6.5)
g2 <- ggplot(ale_gam_all_Length,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.275) +
# geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
ylab("Outcome likelihood") + xlab("Length (cm)") +
coord_cartesian(xlim=c(0.25,10)) + facet_wrap(.~var)
direct.label(g2,"lasso.labels")
dev.off()
pdf("ale_TL_outcome.pdf",height = 5.5,width = 6.5)
g2 <- ggplot(ale_gam_all_Length,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.275) +
# geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
ylab("Outcome likelihood") + xlab("Length (cm)") +
coord_cartesian(xlim=c(0.5,10)) + facet_wrap(.~var)
direct.label(g2,"lasso.labels")
dev.off()
explain_gam_1 <- explain(classif_gam, data = Train[,-1],
y = Train$OutcomeGpNumeric == "1",
predict_function = predgam1, label = "Birth")
explain_gam_2 <- explain(classif_gam, data = Train[,-1],
y = Train$OutcomeGpNumeric == "2",
predict_function = predgam2, label = "Ongoing")
explain_gam_3 <- explain(classif_gam, data = Train[,-1],
y = Train$OutcomeGpNumeric == "3",
predict_function = predgam3, label = "Miscarriage")
explain_gam_4 <- explain(classif_gam, data = Train[,-1],
y = Train$OutcomeGpNumeric == "4",
predict_function = predgam4 , label = "Ectopic")
ale_gam1_age   <- variable_response(explain_gam_1, variable =  "Age", type = "pdp")
ale_gam2_age   <- variable_response(explain_gam_2, variable =  "Age", type = "pdp")
ale_gam3_age   <- variable_response(explain_gam_3, variable =  "Age", type = "pdp")
ale_gam4_age   <- variable_response(explain_gam_4, variable =  "Age", type = "pdp")
ale_gam_all_age <- rbind(ale_gam1_age,ale_gam2_age,ale_gam3_age,ale_gam4_age ) %>%
mutate(method = "GAM")
pdf("ale_age_outcome.pdf",height = 5.5,width = 6.5)
g <- ggplot(ale_gam_all_age,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.3) +
#+ geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
coord_cartesian(xlim=c(20,48),ylim=c(0.1,0.7)) +
xlab("Age (yr)")
direct.label(g,"angled.endpoints")
dev.off()
ale_gam1_Length   <- variable_response(explain_gam_1, variable =  "Length", type = "pdp")
ale_gam2_Length   <- variable_response(explain_gam_2, variable =  "Length", type = "pdp")
ale_gam3_Length   <- variable_response(explain_gam_3, variable =  "Length", type = "pdp")
ale_gam4_Length   <- variable_response(explain_gam_4, variable =  "Length", type = "pdp")
ale_gam_all_Length <- rbind(ale_gam1_Length,ale_gam2_Length,ale_gam3_Length,ale_gam4_Length )
pdf("ale_TL_outcome.pdf",height = 5.5,width = 6.5)
g2 <- ggplot(ale_gam_all_Length,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.275) +
# geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
ylab("Outcome likelihood") + xlab("Length (cm)") +
coord_cartesian(xlim=c(0.5,10)) + facet_wrap(.~var)
direct.label(g2,"lasso.labels")
dev.off()
pdf("ale_age_outcome.pdf",height = 5.5,width = 6.5)
g <- ggplot(ale_gam_all_age,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.3) +
#+ geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
coord_cartesian(xlim=c(20,50),ylim=c(0.1,0.7)) +
xlab("Age (yr)")
direct.label(g,"angled.endpoints")
dev.off()
ale_gam1_fib   <- variable_response(explain_gam_1, variable =  "Fibrosis", type = "pdp")
ale_gam2_fib   <- variable_response(explain_gam_2, variable =  "Fibrosis", type = "pdp")
ale_gam3_fib   <- variable_response(explain_gam_3, variable =  "Fibrosis", type = "pdp")
ale_gam4_fib   <- variable_response(explain_gam_4, variable =  "Fibrosis", type = "pdp")
ale_gam_all_fib <- rbind(ale_gam1_fib,ale_gam2_fib,ale_gam3_fib,ale_gam4_fib ) %>%
mutate(method = "GAM")
ale_gam1_fib   <- variable_response(explain_gam_1, variable =  "Fibrosis", type = "factor")
plot(ale_gam1_fib)
ale_gam2_fib   <- variable_response(explain_gam_2, variable =  "Fibrosis", type = "factor")
ale_gam3_fib   <- variable_response(explain_gam_3, variable =  "Fibrosis", type = "factor")
ale_gam4_fib   <- variable_response(explain_gam_4, variable =  "Fibrosis", type = "factor")
plot(ale_gam2_fib)
plot(ale_gam3_fib)
plot(ale_gam4_fib)
plot(classif_gam)
pdf("ale_TL_outcome.pdf",height = 5.5,width = 6.5)
g2 <- ggplot(ale_gam_all_Length,aes(x=x,y=y,group=label,color=label,fill=label)) +
geom_smooth(method = 'loess',span=0.3) +
# geom_point() +
my_style() +
scale_linetype_stata(name="") +
scale_color_wsj(name="") + ylab("Outcome likelihood") +
scale_fill_wsj(name = "") +
ylab("Outcome likelihood") + xlab("Length (cm)") +
coord_cartesian(xlim=c(0.5,10))
direct.label(g2,"lasso.labels")
dev.off()
4*33.78
table(preg2[,c("Location","OutcomeGpNumeric")])
table(outcomes2[,c("Location","OutcomeGpNumeric")])
gL <- table(outcomes2[,c("Location","OutcomeGpNumeric")])
colnames(gL) <- c("Birth","Ongoing","Miscarriage","Ectopic")
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="OutcomeGpNumeric",ylab="Location",
cex = 1,border="white",
off=1,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="OutcomeGpNumeric",ylab="Location",
cex = 0.75,border="white",
off=1,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Outcome",ylab="Location",
cex = 0.75,border="black",
off=1,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Outcome",ylab="Location",
cex = 0.75,border="black",
off=1.5,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Outcome",ylab="Location",
cex = 0.75,border="black",
off=2,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Outcome",ylab="Location",
cex = 0.75,border="black",
off=4,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Outcome",ylab="Location",
cex = 0.75,border="black",
off=5,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.75,border="black",
off=5,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 1,border="black",
off=5,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.75,border="black",
off=5,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a',
'red','red','red','red'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
ggplot(outcomes2,aes(x=OutcomeGpNumeric,y = 100*(..count..)/sum(..count..),alpha=PREGNANT_NUMERIC,fill=Fibr_rand)) +
geom_bar(position='dodge') + my_style() +
scale_alpha_manual(guide="none",values=c(0.6,1)) +
ylab("") + xlab("Fibrosis") + scale_x_discrete(labels=c("",""))+
scale_fill_wsj(name="") + theme(legend.spacing.x = unit(0.15, 'cm'))
ggplot(outcomes2,aes(x=OutcomeGpNumeric,y = 100*(..count..)/sum(..count..),alpha=OutcomeGpNumeric,fill=Fibr_rand)) +
geom_bar(position='dodge') + my_style() +
scale_alpha_manual(guide="none",values=c(0.6,1)) +
ylab("") + xlab("Fibrosis") + scale_x_discrete(labels=c("",""))+
scale_fill_wsj(name="") + theme(legend.spacing.x = unit(0.15, 'cm'))
ggplot(outcomes2,aes(x=OutcomeGpNumeric,y = 100*(..count..)/sum(..count..),fill=Fibr_rand)) +
geom_bar(position='dodge') + my_style() +
ylab("") + xlab("Fibrosis") + scale_x_discrete(labels=c("",""))+
scale_fill_wsj(name="") + theme(legend.spacing.x = unit(0.15, 'cm'))
ggplot(outcomes2,aes(x=OutcomeGpNumeric,y = 100*(..count..)/sum(..count..),fill=Fibr_rand)) +
geom_bar() + my_style() +
ylab("") + xlab("Fibrosis") + scale_x_discrete(labels=c("",""))+
scale_fill_wsj(name="") + theme(legend.spacing.x = unit(0.15, 'cm'))
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a',
'red','red','red','red'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
mosaicplot(t(gL),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
gLen <- table(outcomes2[,c("Length","OutcomeGpNumeric")])
colnames(gLen) <- c("Birth","Ongoing","Miscarriage","Ectopic")
mosaicplot(t(gLen),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
off=5,las=1)
gF <- table(outcomes2[,c("Fibrosis","OutcomeGpNumeric")])
colnames(gF) <- c("Birth","Ongoing","Miscarriage","Ectopic")
mosaicplot(t(gF),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
gL <- table(outcomes2[,c("Location","OutcomeGpNumeric")])
colnames(gL) <- c("Birth","Ongoing","Miscarriage","Ectopic")
mosaicplot(t(gL),main="",col=c('#fee5d9','#fcae91','#fb6a4a','#cb181d'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
gF <- table(outcomes2[,c("Fibrosis","OutcomeGpNumeric")])
colnames(gF) <- c("Birth","Ongoing","Miscarriage","Ectopic")
mosaicplot(t(gF),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
gD <- table(preg2[,c("Diameter","PREGNANT_NUMERIC")])
colnames(gD) <- c("Birth","Ongoing","Miscarriage","Ectopic")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
gD <- table(preg2[,c("Diameter","OutcomeGpNumeric")])
colnames(gD) <- c("Birth","Ongoing","Miscarriage","Ectopic")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
gD <- table(outcomes2[,c("Diameter","OutcomeGpNumeric")])
colnames(gD) <- c("Birth","Ongoing","Miscarriage","Ectopic")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
rownames(gD)
rownames(gD) <- c("Similar","~Dissimilar","Dissimilar")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
require('latex2exp')
rownames(gD) <- c("Similar",paste(TeX('$\\approx$ Dissimilar'),"Dissimilar"),"Dissimilar")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
rownames(gD) <- c("Similar",TeX('$\\approx$ Dissimilar'),"Dissimilar")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
rownames(gD) <- c("Similar",TeX('$\\approx$ Dissimilar'),"Dissimilar")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
TeX('$\\approx$ Dissimilar')
TeX('$\\approx$ Dissimilar')
rownames(gD) <- c("Similar",'~Dissimilar',"Dissimilar")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
rownames(gD) <- c("Similar",'~ Dissimilar',"Dissimilar")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
gD <- table(outcomes2[,c("Diameter","OutcomeGpNumeric")])
colnames(gD) <- c("Birth","Ongoing","Miscarriage","Ectopic")
rownames(gD) <- c("Similar",'~Dissimilar',"Dissimilar")
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
pdf("mosaic_diam_out.pdf",height = 6,width = 7)
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
dev.off()
pdf("mosaic_fib_out.pdf",height = 6,width = 7)
mosaicplot(t(gF),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
dev.off()
pdf("mosaic_Loc_out.pdf",height = 6,width = 7)
mosaicplot(t(gL),main="",col=c('#fee5d9','#fcae91','#fb6a4a','#cb181d'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.8,border="black",
off=5,las=1)
dev.off()
pdf("mosaic_diam_out.pdf",height = 6,width = 7)
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.85,border="black",
off=5,las=1)
dev.off()
pdf("mosaic_fib_out.pdf",height = 6,width = 7)
mosaicplot(t(gF),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.85,border="black",
off=5,las=1)
dev.off()
pdf("mosaic_Loc_out.pdf",height = 6,width = 7)
mosaicplot(t(gL),main="",col=c('#fee5d9','#fcae91','#fb6a4a','#cb181d'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.85,border="black",
off=5,las=1)
dev.off()
pdf("mosaic_diam_out.pdf",height = 6,width = 7)
mosaicplot(t(gD),main="",col=c('#eff3ff','#bdd7e7','#6baed6','#2171b5'),xlab="Pregnancy Outcome",ylab="Diameter",
cex = 0.85,border="black",
off=5,las=1)
dev.off()
pdf("mosaic_fib_out.pdf",height = 6,width = 7)
mosaicplot(t(gF),main="",col=c('#bf9b30','#f1b502','#ffc004','#ffe28a'),xlab="Pregnancy Outcome",ylab="Fibrosis",
cex = 0.85,border="black",
off=5,las=1)
dev.off()
pdf("mosaic_Loc_out.pdf",height = 6,width = 7)
mosaicplot(t(gL),main="",col=c('#fee5d9','#fcae91','#fb6a4a','#cb181d'),xlab="Pregnancy Outcome",ylab="Location",
cex = 0.85,border="black",
off=5,las=1)
dev.off()
vi_gam <- variable_importance(explain_gam_1,  n_sample = -1,loss_function = loss_entropy,type = "difference")
variable_importance(explain_gam_1,  n_sample = -1,loss_function = MultiLogLoss,type = "difference")
as.numeric(Train[,1])
table(as.numeric(Train[,1]))
predict(classif_gam,type = "response")[,1]
LS1 <- function(y,p){
p <-  predict(classif_gam,type = "response")[,1]
y <- as.numeric(Train[,1])
y_pred <- p
y_true <- y
MultiLogLoss(y_pred, y_true)
}
vi_gam <- variable_importance(explain_gam_1,  n_sample = -1,loss_function = LS1,type = "difference")
as.numeric(Train[,1])
predict(classif_gam,type = "response")[,1]
p <-  predict(classif_gam,type = "response")[,1]
y <- as.numeric(Train[,1])
y_pred <- p
y_true <- y
MultiLogLoss(y_pred, y_true)
vi_gam <- variable_importance(explain_gam_1,
n_sample = -1,
type = "difference")
plot(vi_gam)
outcomes2 <- outcomes %>%
mutate(TL_rand = TL_rand) %>%
mutate(TLD_rand = TLD_rand) %>%
mutate(TLP_rand = TLP_rand) %>%
mutate(ANAS_rand = ANAS_rand) %>%
mutate(Fibr_rand = Fibr_rand) %>%
mutate(OutcomeGpNumeric = as.factor(OutcomeGpNumeric)) %>%
mutate(Diam_rand  = Diam_rand) %>%
select(c("OutcomeGpNumeric",
#"LIGATION_GROUP",
"AGE", "TL_rand","ANAS_rand","Fibr_rand",
"Diam_rand")) %>%
mutate(Fibr_rand = recode(Fibr_rand, "0" = "None",
"1" = "Mild",
"2" = "Moderate",
"3" = "Severe")) %>%
mutate(Fibr_rand = as.factor(Fibr_rand)) %>%
mutate(Fibr_rand = factor(Fibr_rand,levels=c("None","Mild","Moderate","Severe"))) %>%
mutate(ANAS_rand = recode(ANAS_rand, "0" = "Identical",
"1" = "1-SPD",
"2" = "2-SPD",
"3" = "3-SPD")) %>%
mutate(ANAS_rand = factor(ANAS_rand,levels=c("Identical","1-SPD","2-SPD","3-SPD")))  %>%
mutate(Diam_rand = recode(Diam_rand, "1" = "Similar","2" = "Somewhat dissimilar","3" = "Dissimilar")) %>%
mutate(Diam_rand = factor(Diam_rand,levels=c("Similar","Somewhat dissimilar","Dissimilar")))
#colnames(outcomes2) <- c("OutcomeGpNumeric","Sterilization_Method", "Age", "Length","Location","Fibrosis",
#                     "Diameter")
colnames(outcomes2) <- c("OutcomeGpNumeric", "Age", "Length","Location","Fibrosis",
"Diameter")
trainIndex <- createDataPartition(outcomes2$OutcomeGpNumeric, p = .95,
list = FALSE,
times = 1)
Train <- outcomes2[trainIndex,]
#%>% mutate(LIGATION_GROUP = as.numeric(LIGATION_GROUP))
Test  <- outcomes2[-trainIndex,]
#%>% mutate(LIGATION_GROUP = as.numeric(LIGATION_GROUP))
classif_gam <- vgam(OutcomeGpNumeric~
s(Age,bs="cr",k=10)+
s(Length,bs="cr",k=10) +
Location + Fibrosis + Diameter,multinomial, data = Train)
predgam1 <- function(m, x)   predict(m, x, type = "response")[,1]
predgam2 <- function(m, x)   predict(m, x, type = "response")[,2]
predgam3 <- function(m, x)   predict(m, x, type = "response")[,3]
predgam4 <- function(m, x)   predict(m, x, type = "response")[,4]
explain_gam_1 <- explain(classif_gam, data = Train[,-1],
y = Train$OutcomeGpNumeric == "1",
predict_function = predgam1, label = "Birth")
explain_gam_2 <- explain(classif_gam, data = Train[,-1],
y = Train$OutcomeGpNumeric == "2",
predict_function = predgam2, label = "Ongoing")
explain_gam_3 <- explain(classif_gam, data = Train[,-1],
y = Train$OutcomeGpNumeric == "3",
predict_function = predgam3, label = "Miscarriage")
explain_gam_4 <- explain(classif_gam, data = Train[,-1],
y = Train$OutcomeGpNumeric == "4",
predict_function = predgam4 , label = "Ectopic")
vi_gam1 <- variable_importance(explain_gam_1,
n_sample = -1,
type = "difference")
vi_gam2 <- variable_importance(explain_gam_2,
n_sample = -1,
type = "difference")
vi_gam3 <- variable_importance(explain_gam_3,
n_sample = -1,
type = "difference")
vi_gam4 <- variable_importance(explain_gam_4,
n_sample = -1,
type = "difference")
plot(vi_gam2)
plot(vi_gam2)
plot(vi_gam3)
plot(vi_gam4)
loss_entropy <- function(y, p){
y <- as.numeric(y)
-(1/length(y))*sum((y*log(p) + (1-y)*log(1-p))
)
}
vi_gam <- variable_importance(explain_gam_1,
n_sample = -1,loss_function = loss_entropy,
type = "difference")
plot(vi_gam)
plot(vi_gam1)
vi_gam1 <- variable_importance(explain_gam_1,
n_sample = -1,loss_function = loss_entropy,
type = "difference")
vi_gam2 <- variable_importance(explain_gam_2,
n_sample = -1,loss_function = loss_entropy,
type = "difference")
vi_gam3 <- variable_importance(explain_gam_3,
n_sample = -1,loss_function = loss_entropy,
type = "difference")
vi_gam4 <- variable_importance(explain_gam_4,loss_function = loss_entropy,
n_sample = -1,
type = "difference")
plot(vi_gam4 )
plot(vi_gam3)
plot(vi_gam2)
plot(vi_gam1)
plot(vi_gam1,vi_gam2,vi_gam3,vi_gam4)
plot(vi_gam1,vi_gam2,vi_gam3,vi_gam4,layout=c(2,2))
plot(vi_gam1,vi_gam2,vi_gam3,vi_gam4)
pdf("vir_outcome.pdf",height = 10,width = 7.5)
plot(vi_gam1,vi_gam2,vi_gam3,vi_gam4)
dev.off()
plot(TeX("A $\\LaTeX$ formula: $\\frac{2hc^2}{\\lambda^5} \\,
\\frac{1}{e^{\\frac{hc}{\\lambda k_B T}} - 1}$"), cex=2)
plot(TeX("$\\frac{2hc^2}{\\lambda^5} \\,
\\frac{1}{e^{\\frac{hc}{\\lambda k_B T}} - 1}$"), cex=2)
pdf("mosaic_fib_out.pdf",height = 6,width = 7)
mosaicplot(t(gF),main="",col=rev(c('#bf9b30','#f1b502','#ffc004','#ffe28a')),xlab="Pregnancy Outcome",ylab="Fibrosis",
cex = 0.85,border="black",
off=5,las=1)
dev.off()
plot(vi_gam1,vi_gam2,vi_gam3,vi_gam4)
vi_gam1
pdf("vir_outcome1.pdf",height = 5,width = 6)
plot(vi_gam1,vi_gam3)
dev.off()
pdf("vir_outcome2.pdf",height = 5,width = 6)
plot(vi_gam2,vi_gam4)
dev.off()
